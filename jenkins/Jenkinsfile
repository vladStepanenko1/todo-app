pipeline{
    agent any
    environment{
        TELEGRAM_TOKEN_ID = credentials('telegram_token_id')
        TELEGRAM_CHAT_ID = credentials('telegram_chat_id')
        API_URL = "https://api.telegram.org/bot${TELEGRAM_TOKEN_ID}/sendMessage"
        APP_IMAGE_NAME = "todo-app:${env.BUILD_ID}"
        MESSAGE = "${BUILD_TAG}:${currentBuild.currentResult}.\nDocker image ${APP_IMAGE_NAME}"
    }
    stages{
        stage('Build'){
            steps{
                script{
                    def image = docker.build("${APP_IMAGE_NAME}", "-f docker/Dockerfile .")
                }
            }
        }
    }
    post{
        always{
            sh '''curl -s -X POST $API_URL -d chat_id=$TELEGRAM_CHAT_ID -d text="$MESSAGE"'''
        }
    }
}