pipeline{
    agent any
    environment{
        TELEGRAM_TOKEN_ID = credentials('telegram_token_id')
        TELEGRAM_CHAT_ID = credentials('telegram_chat_id')
        API_URL = "https://api.telegram.org/bot${TELEGRAM_TOKEN_ID}/sendMessage"
    }
    stages{
        stage('Build'){
            steps{
                script{
                    def image = docker.build("todo-app:${env.BUILD_ID}", "-f docker/Dockerfile .")
                }
            }
        }
    }
    post{
        always{
            sh("curl -s -X POST ${API_URL} -d chat_id=${TELEGRAM_CHAT_ID} -d text=${PROJECT_NAME:$BUILD_STATUS}")
        }
    }
}